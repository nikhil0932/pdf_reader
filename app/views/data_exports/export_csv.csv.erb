<%
  require 'csv'
  
  csv_data = CSV.generate(headers: true) do |csv|
    # Header row
    csv << [
      'ID',
      'Filename',
      'Title',
      'Licensor',
      'Licensee', 
      'Address',
      'Agreement Date',
      'Start Date',
      'End Date',
      'Agreement Period',
      'Page Count',
      'Uploaded At',
      'Created At',
      'Updated At',
      'Content Preview (First 100 chars)',
      'Filtered Data Preview (First 100 chars)'
    ]
    
    # Data rows
    @pdf_documents.each do |doc|
      csv << [
        doc.id,
        doc.filename,
        doc.title,
        doc.licensor,
        doc.licensee,
        doc.address,
        doc.agreement_date&.strftime('%Y-%m-%d'),
        doc.start_date&.strftime('%Y-%m-%d'),
        doc.end_date&.strftime('%Y-%m-%d'),
        doc.agreement_period,
        doc.page_count,
        doc.uploaded_at&.strftime('%Y-%m-%d %H:%M:%S'),
        doc.created_at.strftime('%Y-%m-%d %H:%M:%S'),
        doc.updated_at.strftime('%Y-%m-%d %H:%M:%S'),
        doc.content&.truncate(100),
        doc.filtered_data&.truncate(100)
      ]
    end
  end
  
  csv_data
%>
