<!DOCTYPE html>
<html>
  <head>
    <title>Data Export - PDF Documents</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    
    <style>
      body { 
        font-family: Arial, sans-serif; 
        max-width: 1200px; 
        margin: 0 auto; 
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      h1 { 
        color: #333; 
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
      }
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }
      .stat-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 6px;
        text-align: center;
        border-left: 4px solid #007bff;
      }
      .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #007bff;
      }
      .export-section {
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 6px;
      }
      .export-buttons {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin: 15px 0;
      }
      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        font-weight: bold;
        transition: background-color 0.3s;
      }
      .btn-primary {
        background-color: #007bff;
        color: white;
      }
      .btn-success {
        background-color: #28a745;
        color: white;
      }
      .btn:hover {
        opacity: 0.9;
        transform: translateY(-1px);
      }
      .filter-form {
        background: white;
        padding: 20px;
        border-radius: 6px;
        margin: 20px 0;
        border: 1px solid #ddd;
      }
      .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }
      .form-group {
        flex: 1;
        min-width: 200px;
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
      }
      .form-group input, .form-group select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      .recent-files {
        margin-top: 30px;
      }
      .file-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .file-item {
        padding: 10px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .file-item:last-child {
        border-bottom: none;
      }
      .file-item:hover {
        background-color: #f8f9fa;
      }
      .badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
      }
      .badge-success {
        background-color: #d4edda;
        color: #155724;
      }
      .badge-warning {
        background-color: #fff3cd;
        color: #856404;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>üìä PDF Documents Data Export</h1>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number"><%= @total_documents %></div>
          <div>Total Documents</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= PdfDocument.where.not(licensor: [nil, '']).count %></div>
          <div>With Licensor</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= PdfDocument.where.not(licensee: [nil, '']).count %></div>
          <div>With Licensee</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= PdfDocument.where.not(agreement_date: nil).count %></div>
          <div>With Agreement Date</div>
        </div>
      </div>

      <div class="export-section">
        <h3>üì• Quick Export - All Data</h3>
        <p>Export all PDF document data in your preferred format:</p>
        <div class="export-buttons">
          <%= link_to "üìä Export to Excel (XLSX)", data_exports_export_excel_path(format: :xlsx), 
                      class: "btn btn-success", 
                      title: "Download all data as Excel file" %>
          <%= link_to "üìÑ Export to CSV", data_exports_export_csv_path(format: :csv), 
                      class: "btn btn-primary",
                      title: "Download all data as CSV file" %>
        </div>
      </div>

      <div class="export-section">
        <h3>üîç Filtered Export</h3>
        <p>Filter and export specific data based on your criteria:</p>
        
        <%= form_with url: data_exports_export_filtered_path, method: :get, local: true, class: "filter-form" do |form| %>
          <div class="form-row">
            <div class="form-group">
              <%= form.label :date_from, "Agreement Date From:" %>
              <%= form.date_field :date_from %>
            </div>
            <div class="form-group">
              <%= form.label :date_to, "Agreement Date To:" %>
              <%= form.date_field :date_to %>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <%= form.label :licensor, "Licensor (contains):" %>
              <%= form.text_field :licensor, placeholder: "e.g. John Doe" %>
            </div>
            <div class="form-group">
              <%= form.label :licensee, "Licensee (contains):" %>
              <%= form.text_field :licensee, placeholder: "e.g. Jane Smith" %>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <%= form.label :period, "Agreement Period (contains):" %>
              <%= form.text_field :period, placeholder: "e.g. 11 Months" %>
            </div>
            <div class="form-group">
              <label>&nbsp;</label>
              <div class="export-buttons">
                <%= form.submit "üìä Export Filtered (Excel)", 
                               formaction: data_exports_export_filtered_path(format: :xlsx),
                               class: "btn btn-success" %>
                <%= form.submit "üìÑ Export Filtered (CSV)", 
                               formaction: data_exports_export_filtered_path(format: :csv),
                               class: "btn btn-primary" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <div class="recent-files">
        <h3>üìÅ Recent Documents</h3>
        <div class="file-list">
          <% @recent_documents.each do |doc| %>
            <div class="file-item">
              <div>
                <strong><%= doc.filename || doc.title %></strong>
                <% if doc.licensor.present? %>
                  <span class="badge badge-success">Has Licensor</span>
                <% end %>
                <% if doc.agreement_date.present? %>
                  <span class="badge badge-success">Has Date</span>
                <% end %>
                <% if doc.licensor.blank? && doc.licensee.blank? %>
                  <span class="badge badge-warning">Missing Data</span>
                <% end %>
              </div>
              <div>
                <small><%= doc.created_at.strftime("%Y-%m-%d %H:%M") %></small>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </body>
</html>
